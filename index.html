<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rat Furniture</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <style>
        /* --- 1. Variables & Reset (Premium "Commerce X" Theme) --- */
        :root {
            --bg-body: #FFFFFF;        /* Pure White Background */
            --bg-card: #F3F3F3;        /* Light Gray Card Background (Reference Style) */
            --text-main: #111111;      /* Deep Black */
            --text-muted: #888888;     /* Soft Gray for labels */
            --accent: #000000;         /* Black Accents */
            --radius: 24px;            /* Large Rounded Corners */
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            margin: 0;
            font-family: var(--font-main);
            background-color: var(--bg-body);
            color: var(--text-main);
            padding-bottom: 100px; /* Space for FAB */
        }

        /* --- 2. Header & Hero Section --- */
        nav {
            padding: 20px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
            z-index: 50;
        }

        .brand {
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        /* The Big Title Area (Matches top of reference) */
        .hero {
            padding: 40px 24px 20px 24px;
            max-width: 800px;
            margin: 0 auto;
        }

        .hero h1 {
            font-size: 2.2rem;
            line-height: 1.1;
            font-weight: 500; /* Thinner, elegant weight */
            margin-bottom: 15px;
            letter-spacing: -1px;
            color: var(--text-main);
        }

        .hero p {
            color: var(--text-muted);
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 25px;
            max-width: 400px;
        }

        .hero-btn {
            display: inline-block;
            background: var(--text-main);
            color: white;
            padding: 12px 24px;
            border-radius: 50px; /* Pill shape */
            text-decoration: none;
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* --- 3. The Grid (Matches bottom of reference) --- */
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px 24px;
        }

        .section-title {
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            margin-bottom: 20px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr)); /* Responsive Grid */
            gap: 20px;
        }

        /* --- 4. Product Card (The "Mouse/Bottle" Look) --- */
        .card {
            background: transparent; /* No background on wrapper */
            display: flex;
            flex-direction: column;
            gap: 12px;
            transition: transform 0.2s;
        }

        .card:hover { transform: translateY(-3px); }

        /* The Gray Box for the Image */
        .image-container {
            background-color: var(--bg-card); /* The #F3F3F3 Gray */
            border-radius: var(--radius);
            aspect-ratio: 1 / 1; /* Perfect Square */
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .image-container img {
            width: 85%; /* Image floats inside with space */
            height: 85%;
            object-fit: contain;
            mix-blend-mode: multiply; /* Helps white images blend onto gray */
        }

        /* Text Below Image */
        .details {
            padding: 0 5px;
        }

        .category-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-muted);
            font-weight: 600;
            margin-bottom: 4px;
            display: block;
        }

        .item-name {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-main);
            margin-bottom: 4px;
            line-height: 1.3;
        }

        .item-price {
            font-size: 0.9rem;
            color: var(--text-main);
            font-weight: 400;
        }

        /* --- 5. Admin Controls (Hidden Overlay) --- */
        .admin-overlay {
            background: white;
            border: 1px solid #eee;
            padding: 10px;
            border-radius: 12px;
            margin-top: 10px;
            display: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        .admin-mode .admin-overlay { display: block; }
        .admin-mode .hero-btn { display: none; } /* Hide buttons when editing */

        .admin-input {
            width: 100%;
            border: 1px solid #ddd;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 5px;
            font-family: inherit;
        }

        .action-row { display: flex; gap: 5px; margin-top: 5px; }

        .btn-act { flex: 1; padding: 8px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.8rem; }
        .btn-save { background: black; color: white; }
        .btn-del { background: #ffebeb; color: #ff3b30; }

        /* --- 6. Floating Add Button --- */
        .fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: black;
            color: white;
            border-radius: 50%;
            border: none;
            font-size: 30px;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            cursor: pointer;
            z-index: 100;
        }
        .admin-mode .fab { display: flex; }

        /* --- 7. Footer --- */
        .footer { text-align: center; padding: 40px; color: #ccc; cursor: pointer; font-size: 0.8rem; }
        .loading { text-align: center; color: #999; grid-column: 1/-1; padding: 50px; }
    </style>
</head>
<body>

    <nav>
        <div class="brand">Rat Furniture</div>
        <div id="admin-badge" style="display:none; font-size:0.7rem; background:black; color:white; padding:4px 8px; border-radius:4px;">ADMIN</div>
    </nav>

    <section class="hero">
        <h1>High-quality furniture<br>& aesthetics</h1>
        <p>Curated minimalist pieces for the modern home. Browse our latest collection below.</p>
        <a href="#catalog" class="hero-btn">Browse Products</a>
    </section>

    <div class="container" id="catalog">
        <div class="section-title">Latest Collection</div>
        
        <div id="grid" class="grid">
            <div class="loading">Loading Collection...</div>
        </div>
    </div>

    <button class="fab" onclick="addItem()">+</button>
    <div class="footer" onclick="toggleAdmin()">
        <span id="lock-text">ðŸ”’ Admin Access</span>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getFirestore, doc, onSnapshot, setDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-storage.js";

        // --- âš ï¸ PASTE YOUR CONFIG HERE âš ï¸ ---
        const firebaseConfig = {
            apiKey: "PASTE_HERE",
            authDomain: "PASTE_HERE",
            projectId: "PASTE_HERE",
            storageBucket: "PASTE_HERE",
            messagingSenderId: "PASTE_HERE",
            appId: "PASTE_HERE"
        };
        // ------------------------------------

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);
        const docRef = doc(db, "catalog", "main");
        
        let products = [];
        let isAdmin = false;
        const PASSKEY = "29876104";

        onSnapshot(docRef, (snap) => {
            if (snap.exists()) {
                products = snap.data().products || [];
                render();
            } else {
                products = [{ name: "Modern Chair", price: "120", img: "" }];
                save();
            }
        });

        function render() {
            const grid = document.getElementById("grid");
            const badge = document.getElementById("admin-badge");
            const lockText = document.getElementById("lock-text");

            grid.innerHTML = "";
            document.body.classList.toggle('admin-mode', isAdmin);
            badge.style.display = isAdmin ? 'block' : 'none';
            lockText.innerText = isAdmin ? "Tap to Exit" : "ðŸ”’ Admin Access";

            if (products.length === 0) grid.innerHTML = '<div class="loading">No products found.</div>';

            products.forEach((p, i) => {
                const imgUrl = p.img || 'https://placehold.co/400x400/F3F3F3/CCCCCC?text=No+Img';
                
                const html = `
                <div class="card">
                    <div class="image-container">
                        <img src="${imgUrl}" id="img-${i}">
                    </div>

                    <div class="details">
                        <div class="view-content" ${isAdmin ? 'style="display:none"' : ''}>
                            <span class="category-label">FURNITURE</span>
                            <div class="item-name">${p.name}</div>
                            <div class="item-price">$${p.price}</div>
                            <a href="https://wa.me/?text=I'm interested in ${encodeURIComponent(p.name)}" 
                               style="display:block; margin-top:8px; font-size:0.8rem; text-decoration:underline; color:#111;">
                               Order via WhatsApp
                            </a>
                        </div>

                        <div class="admin-overlay">
                            <input class="admin-input" id="name-${i}" value="${p.name}" placeholder="Name">
                            <input class="admin-input" id="price-${i}" value="${p.price}" placeholder="Price">
                            
                            <label style="font-size:0.7rem; display:block; margin-bottom:5px; color:blue;">
                                ðŸ“· Change Image
                                <input type="file" style="display:none" onchange="uploadFile(this, ${i})">
                            </label>
                            <span id="status-${i}" style="font-size:0.7rem; color:green;"></span>

                            <div class="action-row">
                                <button class="btn-act btn-save" id="save-${i}" onclick="saveItem(${i})">Save</button>
                                <button class="btn-act btn-del" onclick="delItem(${i})">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>`;
                grid.innerHTML += html;
            });
        }

        window.uploadFile = async (input, index) => {
            const file = input.files[0];
            if (!file) return;
            const status = document.getElementById(`status-${index}`);
            const saveBtn = document.getElementById(`save-${index}`);
            
            status.innerText = "Uploading...";
            saveBtn.disabled = true;

            try {
                const refLink = ref(storage, 'items/' + Date.now() + '-' + file.name);
                await uploadBytes(refLink, file);
                const url = await getDownloadURL(refLink);
                
                products[index].img = url; // Update data array directly
                document.getElementById(`img-${index}`).src = url;
                status.innerText = "Done! Click Save.";
            } catch (e) {
                status.innerText = "Error!";
                console.error(e);
            }
            saveBtn.disabled = false;
        };

        window.saveItem = async (i) => {
            products[i].name = document.getElementById(`name-${i}`).value;
            products[i].price = document.getElementById(`price-${i}`).value;
            // Image is already updated in array by uploadFile
            await save();
            alert("Saved");
        };

        window.addItem = async () => {
            products.push({ name: "New Item", price: "0", img: "" });
            await save();
        };

        window.delItem = async (i) => {
            if(confirm("Delete?")) {
                products.splice(i, 1);
                await save();
            }
        };

        window.toggleAdmin = () => {
            if(!isAdmin) {
                if(prompt("Passkey") === PASSKEY) isAdmin = true;
            } else {
                isAdmin = false;
            }
            render();
        };

        async function save() {
            await setDoc(docRef, { products }, { merge: true });
        }
    </script>
</body>
</html>
